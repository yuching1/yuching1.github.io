<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>å°ç£æ„Ÿæ€§ Landing Page</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href='https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css' rel='stylesheet' />
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body, html { font-family:'Noto Sans TC', sans-serif; background-color: rgb(233,217,194); overflow-x:hidden; }

    header {
      position: fixed; top:0; width:100%; background: rgba(236,199,109,0.95); padding:15px;
      display:flex; justify-content:center; gap:30px; z-index:100; backdrop-filter: blur(10px);
    }
    header div { cursor:pointer; font-weight:bold; font-size:16px; transition:color 0.3s; }
    header div:hover { color: rgb(101,132,101); }

    #map-section { position:relative; height:100vh; background-color: rgb(233,217,194); }
    .map-sticky-container { position: sticky; top:0; width:100%; height:100vh; overflow:hidden; }
    #map { width:100%; height:100%; }

    .photo {
      position: absolute; width:220px; height:147px;
      border:5px solid rgb(101,132,101); border-radius:12px;
      box-shadow:0 10px 30px rgba(0,0,0,0.4);
      object-fit: cover; opacity:0; transform:translate(-50%, -50%) scale(0.8);
      pointer-events:none; z-index:10;
    }

    #scroll-hint {
      position:absolute; bottom:40px; left:50%; transform:translateX(-50%);
      color:white; background: rgba(101,132,101,0.9); padding:12px 24px; border-radius:20px;
      font-weight:600; z-index:20; animation: bounce 2s infinite;
    }
    @keyframes bounce {
      0%,100%{transform:translateX(-50%) translateY(0);}
      50%{transform:translateX(-50%) translateY(-10px);}
    }

    section.next-section {
      height:100vh; background-color: rgb(236,199,109);
      display:flex; align-items:center; justify-content:center;
      font-size:2.5rem; font-weight:bold; color: rgb(101,132,101);
    }

    #debug {
      position: fixed; bottom:10px; right:10px; background: rgba(0,0,0,0.8);
      color:white; padding:10px; border-radius:8px; font-size:12px; font-family:monospace;
      z-index:200; max-width:300px;
    }
  </style>
</head>
<body>
  <header>
    <div>åºç« </div>
    <div>æ„Ÿæ€§ç”Ÿæˆçš„åœ°æ–¹</div>
    <div>å¯©ç¾å·®ç•°èˆ‡å°è©±</div>
    <div>å†ç”Ÿèˆ‡æœªä¾†å¯èƒ½</div>
    <div>çµèª</div>
  </header>

  <section id="map-section">
    <div class="map-sticky-container">
      <div id="map"></div>
      <div id="scroll-hint">â¬‡ å‘ä¸‹æ»¾å‹•æ¢ç´¢å°ç£</div>

      <img src="images/taipei.jpg" class="photo" id="photo-north" />
      <img src="images/taichung.jpg" class="photo" id="photo-central" />
      <img src="images/tainan.jpg" class="photo" id="photo-south" />
      <img src="images/hualien.jpg" class="photo" id="photo-east" />
      <img src="images/penghu.jpg" class="photo" id="photo-island" />
    </div>
  </section>

  <section class="next-section">
    ä¸‹ä¸€å€‹æ®µè½ï¼šæ„Ÿæ€§ç”Ÿæˆçš„åœ°æ–¹
  </section>

  <div id="debug"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
  <script src='https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js'></script>

  <script>
    const debugEl = document.getElementById('debug');
    function debug(msg){
      console.log(msg);
      if(debugEl){
        debugEl.innerHTML = msg + '<br>' + debugEl.innerHTML;
        const lines = debugEl.innerHTML.split('<br>');
        if(lines.length>8){ debugEl.innerHTML = lines.slice(0,8).join('<br>'); }
      }
    }

    function initMap(){
      debug('ğŸš€ é–‹å§‹åˆå§‹åŒ–');

      if(typeof gsap==='undefined' || typeof mapboxgl==='undefined'){
        debug('âŒ åº«æœªè¼‰å…¥'); return;
      }

      mapboxgl.accessToken = 'pk.eyJ1IjoicjEyMjI3MTA2IiwiYSI6ImNtaHJneXdqbDBxbjkyaXM3bnJiOTFraHcifQ.BZIX8VBFwjl65YN9CiM6Hw';

      const map = new mapboxgl.Map({
        container:'map',
        style:'mapbox://styles/mapbox/streets-v12',
        center:[120.9,23.8],
        zoom:6.2,
        pitch:0
      });

      const locations = {
        north:{coords:[121.5654,25.0330], name:'å°åŒ—'},
        central:{coords:[120.6736,24.1477], name:'å°ä¸­'},
        south:{coords:[120.2513,22.9908], name:'å°å—'},
        east:{coords:[121.6015,23.9937], name:'èŠ±è“®'},
        island:{coords:[119.5793,23.5711], name:'æ¾æ¹–'}
      };

      map.on('load', ()=>{
        debug('âœ… åœ°åœ–è¼‰å…¥å®Œæˆ');
        setTimeout(()=>{document.getElementById('scroll-hint').style.opacity='0';},3000);

        gsap.registerPlugin(ScrollTrigger);

        const photoKeys = ['north','central','south','east','island'];
        const totalPhotos = photoKeys.length;

        // åˆå§‹å®šä½ç…§ç‰‡
        function updateAllPhotos(){
          photoKeys.forEach(key=>{
            const el = document.getElementById(`photo-${key}`);
            const loc = locations[key];
            const pt = map.project(loc.coords);
            el.style.left = pt.x + 'px';
            el.style.top = pt.y + 'px';
          });
        }
        updateAllPhotos();
        map.on('move', updateAllPhotos);
        map.on('zoom', updateAllPhotos);

        // ScrollTrigger å‹•ç•«
        ScrollTrigger.create({
          trigger:'#map-section',
          start:'top top',
          end:'bottom top',
          scrub:true,
          pin:true,
          onUpdate: self => {
            const progress = self.progress;

            // åœ°åœ–æ”¾å¤§
            const zoom = progress < 0.4 ? 6.2 + (progress/0.4)*3.5 : 9.7;
            map.setZoom(zoom);

            // ç…§ç‰‡å‹•ç•« 20%~100%ï¼ˆé£›å…¥+æ·¡å…¥ï¼‰
            const t = Math.max((progress-0.2)/(1-0.2), 0);

            photoKeys.forEach((key,index)=>{
              const el = document.getElementById(`photo-${key}`);
              const loc = locations[key];

              const appearStart = index / totalPhotos;
              const appearEnd = (index + 0.8)/totalPhotos;

              let opacity = 0;
              let scale = 0.8;
              let offsetY = 50; // åˆå§‹åç§»50pxå¾€ä¸‹

              if(t >= appearStart){
                const localT = Math.min((t - appearStart)/(appearEnd - appearStart), 1);
                opacity = localT;
                scale = 0.8 + 0.2 * localT;
                offsetY = 50 * (1 - localT); // å¾€ä¸Šé£›å…¥
              }

              el.style.opacity = opacity;
              el.style.transform = `translate(-50%, calc(-50% + ${offsetY}px)) scale(${scale})`;

              // ç¢ºä¿ä½ç½®è·Ÿéš¨åœ°åœ–
              const pt = map.project(loc.coords);
              el.style.left = pt.x + 'px';
              el.style.top = pt.y + 'px';
            });
          }
        });

        debug('ğŸ¬ æ‰€æœ‰å‹•ç•«å·²è¨­ç½®');
      });

      map.on('error', e=>{ debug('âŒ åœ°åœ–éŒ¯èª¤'); console.error(e); });
    }

    window.addEventListener('load', ()=>{ setTimeout(initMap,200); });
  </script>
</body>
</html>
